# 프로젝트 보고서: 상품 이력 추적 블록체인 시스템

## 1. 프로젝트 개요

본 프로젝트는 상품의 생산부터 유통, 최종 소비자에게 전달되기까지의 전 과정을 블록체인에 기록하여 데이터의 투명성과 위변조 불가능성을 보장하는 상품 이력 추적 시스템입니다. 사용자는 이 시스템을 통해 특정 상품의 전체 이력을 조회할 수 있으며, 분산된 노드 환경을 시뮬레이션하여 데이터의 합의 및 동기화 과정을 확인할 수 있습니다.

이 문서는 프로젝트의 구조, 구현된 기능(API), 테스트 전략 및 실행 방법에 대해 기술합니다.

## 2. 프로젝트 구조

프로젝트는 Express.js를 사용한 백엔드 서버로 구성되어 있으며, 핵심 블록체인 로직은 별도의 클래스로 분리하여 관리합니다. 또한, 각 기능별로 라우터를 분리하여 모듈성을 높였습니다.

```
/
├── app.js                    # Express 애플리케이션 설정 및 미들웨어
├── index.js                  # 서버 시작점
├── package.json              # 프로젝트 의존성 및 스크립트 관리
├── blockchain/
│   └── blockchain.js         # 블록체인 핵심 로직 (Blockchain 클래스)
├── middleware/
│   └── auth.js               # (예시) 인증 미들웨어
├── routes/
│   ├── histories.js          # 이력 조회 관련 API 라우터
│   ├── mine.js               # 채굴 관련 API 라우터
│   ├── nodes.js              # 노드 관리 및 합의 관련 API 라우터
│   └── transactions.js       # 트랜잭션 생성 및 관리 관련 API 라우터
└── tests/
    ├── blockchain.test.js    # 기존 블록체인 및 API 통합 테스트
    ├── histories.test.js     # 이력 조회 라우터 테스트
    ├── mine.test.js          # 채굴 라우터 테스트
    ├── nodes.test.js         # 노드 라우터 테스트
    └── transactions.test.js  # 트랜잭션 라우터 테스트
```

## 3. API 명세

본 프로젝트는 과제 요구사항(라우터 4개 이상, 라우터별 API 5개 이상)을 충족하기 위해 총 4개의 핵심 라우터에 22개의 API를 구현했습니다.

### 3.1. Histories API (`/histories`)

상품, 주소, 블록 등 다양한 조건으로 블록체인에 기록된 이력을 조회하는 API입니다.

-   **`GET /:productId`**: 특정 상품 ID의 전체 거래 이력을 조회합니다.
-   **`GET /transactions/:transactionId`**: 특정 트랜잭션 ID로 상세 정보를 조회합니다.
-   **`GET /address/:address`**: 특정 지갑 주소와 관련된 모든 거래를 조회합니다.
-   **`GET /block/:blockHash`**: 특정 블록 해시로 해당 블록의 정보를 조회합니다.
-   **`GET /latest/:count`**: 가장 최근에 생성된 `count` 개의 트랜잭션을 조회합니다.

### 3.2. Mine API (`/mine`)

블록 생성(채굴)과 관련된 기능을 제어하는 API입니다.

-   **`POST /`**: 새로운 블록을 하나 채굴합니다.
-   **`GET /status`**: 현재 채굴 상태(마지막 블록, 보류 중인 트랜잭션 수 등)를 조회합니다.
-   **`POST /start`**: 연속 채굴을 시작합니다. (테스트 및 데모용)
-   **`POST /stop`**: 진행 중인 연속 채굴을 중지합니다.
-   **`GET /difficulty`**: 현재 설정된 채굴 난이도를 조회합니다.
-   **`PUT /difficulty`**: 채굴 난이도를 동적으로 변경합니다. (테스트 및 데모용)

### 3.3. Nodes API (`/nodes`)

분산 네트워크를 구성하는 노드를 관리하고, 노드 간 데이터 동기화를 위한 합의 과정을 수행하는 API입니다.

-   **`GET /`**: 현재 네트워크에 등록된 모든 노드의 목록을 조회합니다.
-   **`POST /register-and-broadcast-node`**: 새로운 노드를 네트워크에 등록하고, 이 사실을 다른 모든 노드에게 전파합니다.
-   **`POST /register-node`**: 다른 노드로부터 정보를 받아 자신의 노드 목록에 새 노드를 등록합니다.
-   **`POST /register-nodes-bulk`**: 여러 노드의 정보를 한 번에 등록합니다.
-   **`GET /consensus`**: "가장 긴 체인 규칙"에 따라 다른 노드와 데이터를 비교하여 자신의 블록체인을 동기화합니다.

### 3.4. Transactions API (`/transactions`)

거래(트랜잭션)를 생성하고 관리하는 API입니다.

-   **`GET /`**: 현재 처리 대기 중인 모든 트랜잭션 목록을 조회합니다.
-   **`POST /`**: 새로운 트랜잭션을 생성하여 자신의 처리 대기 목록에 추가합니다.
-   **`POST /broadcast`**: 새로운 트랜잭션을 생성하고 네트워크의 모든 노드에게 전파합니다.
-   **`POST /pending/broadcast`**: 현재 보류 중인 모든 트랜잭션을 네트워크에 전파합니다.
-   **`GET /:transactionId`**: 특정 트랜잭션 ID로 상세 정보를 조회합니다.
-   **`GET /block/:blockIndex`**: 특정 블록 인덱스로 해당 블록에 포함된 트랜잭션 목록을 조회합니다.

## 4. 테스트 전략 및 결과

### 4.1. 테스트 전략

-   **단위/통합 테스트:** `jest`와 `supertest` 라이브러리를 사용하여 각 API 엔드포인트의 기능과 비즈니스 로직을 검증하는 단위 및 통합 테스트를 구현했습니다.
-   **테스트 분리:** 기능별 명확한 테스트를 위해 라우터 단위로 테스트 파일을 분리했습니다. (`histories.test.js`, `mine.test.js` 등)
-   **독립성 보장:** 각 테스트 케이스가 다른 테스트에 영향을 주지 않도록 `beforeEach` 훅을 사용하여 테스트 실행 전에 블록체인 상태를 매번 초기화했습니다.
-   **Mocking:** `axios` 라이브러리를 모킹하여 실제 네트워크 요청 없이 노드 간 통신을 시뮬레이션하고, 다양한 성공/실패 시나리오를 테스트했습니다.

### 4.2. 테스트 결과

-   **총 테스트 스위트:** 5개
-   **총 테스트 케이스:** 50개
-   **결과:** **모든 테스트 통과 (PASS)**

모든 기능이 예상대로 동작함을 테스트를 통해 확인했습니다.

## 5. 프로젝트 실행 방법

### 5.1. 의존성 설치

프로젝트 루트 디렉토리에서 다음 명령어를 실행하여 필요한 모든 패키지를 설치합니다.

```bash
npm install
```

### 5.2. 서버 실행

다음 명령어를 사용하여 서버를 시작합니다. 기본적으로 `3000`번 포트에서 실행됩니다.

```bash
npm start
```

### 5.3. 테스트 실행

다음 명령어를 사용하여 구현된 모든 테스트를 실행합니다.

```bash
npm test
```

---

이것으로 코드의 기술적 요구사항 준수 및 완성도 향상을 위한 모든 작업을 마쳤습니다. 최종 제출을 위한 보고서 작성 및 기타 요구사항 준비에 이 문서가 도움이 되기를 바랍니다.
